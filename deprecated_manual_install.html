<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>ElmerFoamFSI: Manual Installation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="IRTriangles_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ElmerFoamFSI
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">ElmerFoamFSI is an aeroelastic simulation application built up from OpenFOAM CFD and Elmer CSM coupled through the IMPACT multiphysics software integration infrastructure</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('deprecated_manual_install.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Manual Installation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The general quick-start steps for installing <b><em><a class="el" href="namespaceElmerFoamFSI.html" title="Project-specific namespace. ">ElmerFoamFSI</a></em></b> are as follows:</p>
<dl class="section note"><dt>Note</dt><dd>The instructions presented herein require a Linux terminal. As such the commands are fairly general and are not shell specific. For these reasons instructions that require setting paths are left deliberately vague. Users should set path variables using the form dictated by their shell environment. The general forms for bash and csh are given here for ease-of-use. Note the syntax; it is <b><em>very</em></b> important! Users can determine their current shell environment by using SHELL. <blockquote class="doxtable">
<p>echo $SHELL <br />
/bin/bash: export USR_VAR="/path/to/user/location/" <br />
../bin/csh: setenv USR_VAR /path/to/user/location </p>
</blockquote>
</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd><ul>
<li>Users will need to modify one critical file <em>before</em> building <b><em>OpenFOAM</em></b>. These changes enable options that are used to build other components of the <b><em><a class="el" href="namespaceElmerFoamFSI.html" title="Project-specific namespace. ">ElmerFoamFSI</a></em></b> package. If users do not follow this step, <b><em>OpenFOAM</em></b> will need to be rebuilt after enabling these options.</li>
<li>According to the <b><em>Elmer</em></b> forum, <b><em>Elmer</em></b> uses gfortran of versions 4.8 or later. Be sure to start with v-4.8+, or users will have rebuild the system from scratch. A consistent toolchain is <b><em>mandatory</em></b> to install the <b><em><a class="el" href="namespaceElmerFoamFSI.html" title="Project-specific namespace. ">ElmerFoamFSI</a></em></b> application!</li>
</ul>
</dd></dl>
<h3>1. Install <b><em>OpenFOAM</em></b> extend from <a href="http://www.extend-project.de/" title="OpenFOAM Extend Project">OpenFOAM-extend</a></h3>
<ul>
<li>Download <em>foam-extend</em> latest release</li>
<li>Unpack the source into <b>~/foam/foam-extend-&lt;version&gt;</b></li>
<li>Review the native <b><em>OpenFOAM</em></b> build instructions: <b>~/foam/foam-extend-&lt;version&gt;/doc/buildInstructions</b></li>
<li>Install system packages (optional, but recommended)</li>
<li>Modify the <em>%build</em> section of the spec file associated with the lastest version of openmpi (e.g., openmpi-1.6.5.spec) <blockquote class="doxtable">
<p>cd ~/foam/foam-extend-&lt;version&gt; <br />
cd ./ThirdParty/rpmBuild/SPECS <br />
ls openmpi* <br />
<em>open associated spec file using editor of choice (e.g., vi or emacs)</em> </p>
</blockquote>
** In the section labeled "export WM settings in a form that GNU configure recognizes," add the "-fPIC" option flag to the <em>CC</em> and <em>CXX</em> lines: <blockquote class="doxtable">
<p>[ -n "$WM_CC" ] &amp;&amp; export CC="$WM_CC -fPIC" <br />
[ -n "$WM_CXX" ] &amp;&amp; export CXX="$WM_CXX -fPIC" <br />
</p>
</blockquote>
** Just below this same section, add two export statements before "unset mpiWith": <blockquote class="doxtable">
<p>export FC="gfortran -fPIC" <br />
export F90="gfortran -fPIC" <br />
unset mpiWith </p>
</blockquote>
** Slightly farther down in the <em>./configure</em> section, delete the following lines: <blockquote class="doxtable">
<p>--disable-mpi-f77 <br />
--disable-mpi-f90 <br />
--disable-mpi-cxx </p>
</blockquote>
</li>
<li>Source the appropriate shell script (bash or csh)</li>
<li>Build with (or without) <b><em>ParaView</em></b> (user choice)</li>
<li>Review the build output to make sure that the 5 stages of <b><em>OpenFOAM</em></b> built properly <blockquote class="doxtable">
<p>cd ~/foam/foam-extend*<br />
 source etc/cshrc <br />
./Allwmake.firstInstall | tee build_firstInstall.out <br />
grep "Done" build_firstInstall.out </p>
</blockquote>
</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Users can choose to install <b><em>OpenFOAM</em></b> in an alternate location than <b>~/foam</b> (i.e., /usr/home), but doing so requires setting an additional path. Here <b>$USR_DIR</b> is the path to the unpacked <b><em>OpenFOAM</em></b> source. This location <b>must</b> contain the source directory <b>/foam/foam-extend-&lt;version&gt;</b>. <blockquote class="doxtable">
<p>FOAM_INST_DIR = ~/[USR_DIR] <br />
</p>
</blockquote>
Users <b>must also</b> then modify the shell script accordingly (e.g., ~/etc/cshrc): <blockquote class="doxtable">
<p>set foamInstall=$FOAM_INST_DIR/$WM_PROJECT <br />
setenv WM_PROJECT_INST_DIR $FOAM_INST_DIR/$WM_PROJECT <br />
setenv WM_PROJECT_USER_DIR $FOAM_INST_DIR/$WM_PROJECT/$USER-$WM_PROJECT_VERSION </p>
</blockquote>
</dd></dl>
<h3>2. Set up the proper user build environment for the rest of the toolchain</h3>
<ul>
<li>(Re-)source the appropriate shell script (bash or csh) <blockquote class="doxtable">
<p>source ~/foam/foam-extend-&lt;version&gt;/etc/cshrc </p>
</blockquote>
</li>
<li>Set the <em>CC</em>, <em>CXX</em>, and <em>FC</em> environment variables <blockquote class="doxtable">
<p>CC = mpicc<br />
CXX = mpicxx<br />
FC = mpif90 </p>
</blockquote>
</li>
<li>Ensure that the correct version of compiler wrappers are being used. The system should return some <b><em>OpenFOAM</em></b> path to MPI and the system version of the compiler to which the wrapper points. <blockquote class="doxtable">
<p>which mpicc <br />
mpicc --version <br />
which mpicxx <br />
mpicxx --version <br />
which mpif90 <br />
mpif90 --version <br />
</p>
</blockquote>
</li>
<li>If users receive a system error, it is likely associated with missing modifications to the openmpi spec file.</li>
</ul>
<h3>3. Install <b><em>IMPACT</em></b> and <b><em>IRAD</em></b> infrastructures from <a href="http://openmultiphysics.org">ElmerFoamSupport</a></h3>
<p>Because the <b><em>IMPACT</em></b> and <b><em>IRAD</em></b> infrastructures are really just used as <em>support</em> libraries, the following build scenario is recommended. Note that these support libraries should be built <em>out-of-source</em> <b>but</b> installed <em>in the same place</em>.</p><ul>
<li>Create a new directory for ElmerFoamSupport</li>
<li>Create a new subdirectory for install <blockquote class="doxtable">
<p>mkdir /user/desired/location/ElmerFoamSupport <br />
cd ~/ElmerFoamSupport <br />
mkdir support_install <br />
</p>
</blockquote>
</li>
<li>Download latest release of <b><em>IRAD</em></b></li>
<li>Unpack <b><em>IRAD</em></b> into ~/ElmerFoamSupport/ location (e.g., ~/irad_source)</li>
<li>Install <b><em>IRAD</em></b> <blockquote class="doxtable">
<p>cd ~/ElmerFoamSupport <br />
git clone git://github.com/IllinoisRocstar/IRAD irad <br />
cd ~/ElmerFoamSupport/irad_build <br />
cmake -DCMAKE_INSTALL_PREFIX=/full/path/to/selected/support/install ../short/path/to/irad/source <br />
make <br />
make install <br />
</p>
</blockquote>
</li>
<li>Download latest release of <b><em>IMPACT</em></b></li>
<li>Unpack <b><em>IMPACT</em></b> into ~/ElmerFoamSupport/ location (e.g., ~/impact_source)</li>
<li>Install <b><em>IMPACT</em></b> and include <b><em>IRAD</em></b> and HDF4 dependencies <blockquote class="doxtable">
<p>sudo yum install hdf4 hdf4-devel <br />
cd ~/ElmerFoamSupport <br />
git clone git://github.com/IllinoisRocstar/IMPACT impact <br />
cd ~/ElmerFoamSupport/impact_build <br />
cmake -DCMAKE_INSTALL_PREFIX=/full/path/to/selected/support/install ../short/path/to/impact/source <br />
make <br />
make install <br />
</p>
</blockquote>
</li>
</ul>
<h3>4. Install <b><em>Elmer</em></b> from <a href="https://www.csc.fi/web/elmer">CSC-Elmer</a></h3>
<ul>
<li>Download latest release of <b><em>Elmer</em></b></li>
<li>Unpack <b><em>Elmer</em></b> into desired location (e.g., ~/elmer_source)</li>
<li>It is recommended to build <b><em>Elmer</em></b> out-of-source (i.e., separate build and install directories) <blockquote class="doxtable">
<p>cd ~/elmer_build <br />
cmake -DCMAKE_INSTALL_PREFIX=/full/path/to/selected/elmer/install ../short/path/to/elmer/source <br />
make <br />
make install <br />
</p>
</blockquote>
</li>
</ul>
<h3>5. Update (patch) <b><em>OpenFOAM</em></b> and rebuild (build the <b><em>OpenFoamFSI</em></b> module)</h3>
<ul>
<li>Obtain <b><em>OpenFOAM</em></b> module native source from <a href="http://openmultiphysics.org">OpenFoamModule</a></li>
<li>Unpack <b><em>OpenFoamFSI</em></b> module in desired location (e.g., ~/OpenFoamFSIdriver)</li>
<li>Set IRMULTIPHYSICS to install location of ElmerFoamSupport for IMPACT / IRAD dependencies <blockquote class="doxtable">
<p>mkdir /user/desired/location/OpenFoamFSIdriver <br />
 git clone git://github.com/openmultiphysics/OpenFoamModule.git OpenFoamModule <br />
IRMULTIPHYSICS = /full/path/to/selected/ElmerFoamSupport/install <br />
</p>
</blockquote>
</li>
<li>Check the definition of MPI_HOME that specifies the location of the desired openmpi libraries. <br />
The system should return some path containing "~/foam/foam-extend-&lt;version&gt;/ThirdParty/packages/..." <br />
The path will look similar to the location of the spec file edited in Step 1. <blockquote class="doxtable">
<p>echo $MPI_HOME </p>
</blockquote>
</li>
<li>Create the <b><em>OpenFoamFSI</em></b> library that will be automatically copied into the library directory of the unaltered <b><em>OpenFOAM</em></b> <blockquote class="doxtable">
<p>cd ~/OpenFoamFSIdriver/OpenFoamModule/native <br />
wmake libso . </p>
</blockquote>
</li>
<li>Build the <b><em>OpenFoamFSI</em></b> driver and test: 14 tests in approximately 1.5 min. <blockquote class="doxtable">
<p>cd ~/OpenFoamFSIdriver/OpenFoamModule/ <br />
cmake -DCMAKE_PREFIX_PATH=/full/path/to/selected/ElmerFoamSupport/install <br />
make <br />
make test <br />
</p>
</blockquote>
</li>
</ul>
<h3>6. Update (patch) <b><em>Elmer</em></b> and rebuild (build the <b><em>ElmerFSI</em></b> module)</h3>
<ul>
<li>Obtain <b><em>Elmer</em></b> module native source from <a href="http://openmultiphysics.org">ElmerModule</a></li>
<li>Place module native source directory <b>inside</b> existing source: <b>~/elmer_source/fem/src</b> <blockquote class="doxtable">
<p>cd ~/elmer_source/fem/src <br />
git clone git://github.com/openmultiphysics/ElmerModule.git ElmerModule <br />
</p>
</blockquote>
</li>
<li>Edit the <em>CMakeList.txt</em> file in <b>~/elmer_source/fem/src</b> to include this new directory name <blockquote class="doxtable">
<p>ADD_SUBDIRECTORY (ElmerModule) <br />
</p>
</blockquote>
</li>
<li>Patch the <b><em>Elmer</em></b> source <blockquote class="doxtable">
<p>patch &lt; ElmerModule/ElmerPatch </p>
</blockquote>
</li>
<li>Remove the old directories and reinstall the patched <b><em>Elmer</em></b> source, linking to IMPACT <blockquote class="doxtable">
<p>rm -r ~/elmer_build ~/elmer_install <br />
mkdir ~/elmer_build ~/elmer_install <br />
cd ~/elmer_build <br />
cmake -DCMAKE_PREFIX_PATH=/full/path/to/selected/ElmerFoamSupport/install -DCMAKE_INSTALL_PREFIX=/full/path/to/selected/elmer/install ../short/path/to/elmer/source <br />
make <br />
make install <br />
</p>
</blockquote>
</li>
<li>Set the LD library path to the location of the Elmer native libraries. <blockquote class="doxtable">
<p>LD_LIBRARY_PATH = /full/path/to/selected/patched/Elmer/install/lib/ $LD_LIBRARY_PATH <br />
</p>
</blockquote>
</li>
<li>Obtain, build, and test the <b><em>ElmerFSI</em></b> driver: XX tests in approximately XX min. <blockquote class="doxtable">
<p>git clone git://github.com/openmultiphysics/ElmerModuleDriver.git <a class="el" href="namespaceElmerModuleDriver.html" title="Project-specific namespace. ">ElmerModuleDriver</a> <br />
cd ~/build_ElmerModuleDriver/ <br />
cmake -DCMAKE_PREFIX_PATH=/full/path/to/selected/ElmerFoamSupport/install ../short/path/to/ElmerModuleDriver/source <br />
make <br />
make test <br />
</p>
</blockquote>
</li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>After completing <b>Steps 1 - 6</b>, users should have the following installed components <blockquote class="doxtable">
<p>~/foam (+ module) <br />
~/elmer (+ module) <br />
~/fsiSupport (IMPACT + IRAD) </p>
</blockquote>
If, for whatever reason, one or more of these directories does not exist, start over at the appropriate step! <br />
If one or more of these directories does not appear to be correct, remove the attempted build of the associated component, and start over at the appropriate step! O_o <br />
If everything looks good, the last step in building <b><em><a class="el" href="namespaceElmerFoamFSI.html" title="Project-specific namespace. ">ElmerFoamFSI</a></em></b> can be completed! ^_^</dd></dl>
<h3>7. Install <b><em><a class="el" href="namespaceElmerFoamFSI.html" title="Project-specific namespace. ">ElmerFoamFSI</a></em></b> orchestrator (OpenFOAM-Elmer system driver for FSI problems)</h3>
<ul>
<li>Obtain <b><em><a class="el" href="namespaceElmerFoamFSI.html" title="Project-specific namespace. ">ElmerFoamFSI</a></em></b> native source from <a href="http://openmultiphysics.org">ElmerFoamFSIdriver</a></li>
<li>Build and test the <b><em><a class="el" href="namespaceElmerFoamFSI.html" title="Project-specific namespace. ">ElmerFoamFSI</a></em></b> driver: XX tests in approximately XX min. <blockquote class="doxtable">
<p>git clone git://github.com/openmultiphysics/ElmerFoamFSI.git <a class="el" href="namespaceElmerFoamFSI.html" title="Project-specific namespace. ">ElmerFoamFSI</a> <br />
cd ~/build_ElmerFoamFSI/ <br />
cmake -DCMAKE_PREFIX_PATH=/full/path/to/selected/ElmerFoamSupport/install ../short/path/to/ElmerFoamFSI/source <br />
make <br />
make docs <br />
make test <br />
 </p>
</blockquote>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Mar 1 2016 14:09:51 for ElmerFoamFSI by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
