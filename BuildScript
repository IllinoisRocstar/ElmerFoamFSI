#!/bin/bash

isFirst=false
noTest=false

if [ "$1" = "First" ] || [ "$1" = "FIRST" ] || [ "$1" = "first" ] || [ "$2" = "First" ] || [ "$2" = "FIRST" ] || [ "$2" = "first" ]
then
  isFirst=true
fi
if [ "$1" = "notest" ] || [ "$1" = "NoTest" ] || [ "$1" = "NOTEST" ] || [ "$2" = "notest" ] || [ "$2" = "NoTest" ] || [ "$2" = "NOTEST" ] 
then
  noTest=true
fi

# Set our current directory, which should be the top
# level source for ElmerFoamFSI
topSourceDir=`pwd`
installDir="$topSourceDir/support_install"

if $isFirst
then
  echo "Patching OpenFoam & Elmer for the first build"
  ./BuildTools/PatchScript $topSourceDir
fi

echo "Sourcing BashSourceScript"

# Source the SourceScript to ensure the proper build environment
source BuildTools/BashSourceScript $topSourceDir

# Build OpenFoam
#if $isFirst
#then 
#  ./BuildTools/BuildOpenFoam $topSourceDir first
#else 
#  ./BuildTools/BuildOpenFoam $topSourceDir
#fi

## Build IMPACT, which will also build IRAD 
./BuildTools/BuildImpact $topSourceDir

# Build elmer and the elmer module
./BuildTools/BuildElmerModule $topSourceDir

# Build openfoam module
./BuildTools/BuildOpenFoamModule $topSourceDir

# Build the ElmerFoamFSI driver
if $noTest
then
  ./BuildTools/BuildElmerFoamFSIDriver $topSourceDir noTest
else
  ./BuildTools/BuildElmerFoamFSIDriver $topSourceDir
fi
